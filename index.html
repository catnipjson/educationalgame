
<!DOCTYPE html>
<html>
<head>
  <title>dead corners</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #111;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #222;
      touch-action: none;
    }
    #menu, #endScreen {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: rgba(0,0,0,0.8);
      color: white;
      font-family: sans-serif;
      font-size: 24px;
      z-index: 10;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 20px;
    }
    #touchControls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      display: none;
      justify-content: space-between;
    }
    .btn {
      width: 80px;
      height: 80px;
      background: rgba(255,255,255,0.2);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 80px;
      font-size: 30px;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>2D FPS Game</h1>
    <button onclick="startGame('1v1')">1v1</button>
    <button onclick="startGame('zombies')">Zombies</button>
  </div>
  <div id="endScreen" style="display:none;"></div>
  <canvas id="game" width="800" height="600"></canvas>
  <div id="touchControls">
    <div>
      <div class="btn" ontouchstart="touchMove('left')" ontouchend="stopMove()">←</div>
      <div class="btn" ontouchstart="touchMove('right')" ontouchend="stopMove()">→</div>
    </div>
    <div class="btn" ontouchstart="shooting=true" ontouchend="shooting=false">Shoot</div>
  </div>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    let menu = document.getElementById("menu");
    let endScreen = document.getElementById("endScreen");
    let touchControls = document.getElementById("touchControls");

    let keys = {};
    let shooting = false;
    let gameMode = "";
    let player, enemies, bullets, walls, gameOver, killCount, shootCooldown = 0;

    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);
    canvas.addEventListener("touchstart", e => e.preventDefault(), { passive: false });

    function touchMove(dir) {
      keys[dir === "left" ? "a" : "d"] = true;
    }
    function stopMove() {
      keys["a"] = false;
      keys["d"] = false;
    }

    function startGame(mode) {
      menu.style.display = "none";
      touchControls.style.display = "flex";
      gameMode = mode;
      gameOver = false;
      killCount = 0;
      player = { x: 100, y: 300, w: 30, h: 30, hp: 100 };
      bullets = [];
      enemies = [];
      walls = [{ x: 300, y: 200, w: 200, h: 30 }, { x: 100, y: 400, w: 600, h: 30 }];
      if (mode === "1v1") {
        enemies.push({ x: 600, y: 300, w: 30, h: 30, hp: 100, cooldown: 0 });
      }
      requestAnimationFrame(update);
    }

    function shoot(from, dir) {
      bullets.push({ x: from.x + from.w / 2, y: from.y + from.h / 2, dir: dir, from });
    }

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (gameOver) return;

      // Player movement
      if (keys["a"]) player.x -= 3;
      if (keys["d"]) player.x += 3;
      if ((keys[" "] || shooting) && shootCooldown <= 0) {
        shoot(player, 1);
        shootCooldown = 20;
      }
      shootCooldown--;

      // Enemy AI
      for (let e of enemies) {
        if (e.hp <= 0) continue;
        let dx = player.x - e.x;
        e.x += dx > 0 ? 1 : -1;
        if (e.cooldown <= 0 && !inWallSight(e, player)) {
          shoot(e, -1);
          e.cooldown = 60;
        }
        e.cooldown--;
      }

      // Bullet update
      for (let b of bullets) {
        b.x += b.dir * 5;
        let targets = b.from === player ? enemies : [player];
        for (let t of targets) {
          if (t.hp > 0 && b.x > t.x && b.x < t.x + t.w && b.y > t.y && b.y < t.y + t.h) {
            t.hp -= 15;
            b.hit = true;
            if (t.hp <= 0 && gameMode === "zombies" && b.from === player) killCount++;
          }
        }
        for (let w of walls) {
          if (b.x > w.x && b.x < w.x + w.w && b.y > w.y && b.y < w.y + w.h) b.hit = true;
        }
      }
      bullets = bullets.filter(b => !b.hit);

      // Zombie spawn
      if (gameMode === "zombies" && Math.random() < 0.02) {
        enemies.push({
          x: Math.random() < 0.5 ? 0 : canvas.width - 30,
          y: 300 + Math.random() * 100 - 50,
          w: 30, h: 30, hp: 100, cooldown: 0
        });
      }

      // Draw walls
      ctx.fillStyle = "gray";
      for (let w of walls) ctx.fillRect(w.x, w.y, w.w, w.h);

      // Draw player
      if (player.hp > 0) {
        ctx.fillStyle = "blue";
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.fillStyle = "white";
        ctx.fillText("HP: " + player.hp, player.x, player.y - 10);
      }

      // Draw enemies
      ctx.fillStyle = "red";
      for (let e of enemies) {
        if (e.hp > 0) {
          ctx.fillRect(e.x, e.y, e.w, e.h);
          ctx.fillStyle = "white";
          ctx.fillText("HP: " + e.hp, e.x, e.y - 10);
          ctx.fillStyle = "red";
        }
      }

      // Draw bullets
      ctx.fillStyle = "yellow";
      for (let b of bullets) ctx.fillRect(b.x, b.y, 5, 2);

      if (player.hp <= 0) {
        endScreen.innerHTML = `<h1>YOU DIED</h1>${gameMode === "zombies" ? `<p>Zombies defeated: ${killCount}</p>` : ""}`;
        endScreen.style.display = "flex";
        setTimeout(() => location.reload(), 4000);
        gameOver = true;
      }

      if (gameMode === "1v1" && enemies.every(e => e.hp <= 0)) {
        endScreen.innerHTML = "<h1>ENEMY DEFEATED</h1>";
        endScreen.style.display = "flex";
        setTimeout(() => location.reload(), 4000);
        gameOver = true;
      }

      if (!gameOver) requestAnimationFrame(update);
    }

    function inWallSight(a, b) {
      for (let w of walls) {
        let withinY = b.y + b.h > w.y && b.y < w.y + w.h;
        let betweenX = (a.x < w.x && b.x > w.x) || (a.x > w.x + w.w && b.x < w.x + w.w);
        if (withinY && betweenX) return true;
      }
      return false;
    }
  </script>
</body>
</html>
